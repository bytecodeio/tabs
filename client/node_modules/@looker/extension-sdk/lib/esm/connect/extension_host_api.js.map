{"version":3,"file":"extension_host_api.js","names":["EXTENSION_SDK_VERSION","ExtensionHostApiImpl","constructor","configuration","_configuration","chattyHost","setInitialRoute","hostChangedRoute","lookerHostData","_lookerHostData","handleNotification","message","type","payload","ExtensionNotificationType","ROUTE_CHANGED","route","routeState","undefined","INITIALIZE","contextData","errorMessage","requiredLookerVersion","lookerVersion","verifyLookerVersion","console","error","extensionSdkVersion","Error","createSecretKeyTag","keyName","match","extensionId","replace","verifyHostConnection","sendAndReceive","ExtensionRequestType","VERIFY_HOST","invokeCoreSdk","httpMethod","path","params","body","authenticator","options","apiVersion","INVOKE_CORE_SDK","invokeCoreSdkRaw","RAW_INVOKE_CORE_SDK","updateTitle","title","send","UPDATE_TITLE","updateLocation","url","state","target","UPDATE_LOCATION","spartanLogout","SPARTAN_LOGOUT","openBrowserWindow","closeHostPopovers","CLOSE_HOST_POPOVERS","clientRouteChanged","localStorageSetItem","name","value","Promise","reject","LOCAL_STORAGE","localStorageGetItem","localStorageRemoveItem","clipboardWrite","CLIPBOARD","userAttributeSetItem","USER_ATTRIBUTE","userAttributeGetItem","userAttributeResetItem","getContextData","JSON","parse","saveContextData","context","stringify","err","CONTEXT_DATA","refreshContextData","track","trackAction","attributes","TRACK_ACTION","errorEvent","filename","lineno","colno","ERROR_EVENT","toString","unloaded","EXTENSION_UNLOADED","createFetchProxy","baseUrl","init","responseBodyType","FetchProxyImpl","fetchProxy","resource","INVOKE_EXTERNAL_API","serverProxy","oauth2Authenticate","authEndpoint","authParameters","validateAuthParameters","signal","AbortController","oauth2ExchangeCodeForToken","messagePayload","chattyPayload","ExtensionEvent","EXTENSION_API_REQUEST","then","values","version","intersects","client_id","redirect_uri","response_type"],"sources":["../../../src/connect/extension_host_api.ts"],"sourcesContent":["/*\n\n MIT License\n\n Copyright (c) 2021 Looker Data Sciences, Inc.\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in all\n copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n SOFTWARE.\n\n */\n\nimport type { ChattyHostConnection, Options } from '@looker/chatty'\nimport intersects from 'semver/ranges/intersects'\nimport { FetchProxyImpl } from './fetch_proxy'\nimport type {\n  ExtensionInitializationResponse,\n  ExtensionHostApi,\n  ExtensionHostApiConfiguration,\n  ExtensionNotification,\n  FetchCustomParameters,\n  FetchResponseBodyType,\n  LookerHostData,\n  ApiVersion,\n  RouteChangeData,\n} from './types'\nimport {\n  ExtensionEvent,\n  ExtensionNotificationType,\n  ExtensionRequestType,\n} from './types'\n\nexport const EXTENSION_SDK_VERSION = '0.10.5'\n\nexport class ExtensionHostApiImpl implements ExtensionHostApi {\n  private _configuration: ExtensionHostApiConfiguration\n  private _lookerHostData?: Readonly<LookerHostData>\n  private chattyHost: ChattyHostConnection\n  private setInitialRoute?: (route: string, routeState?: any) => void\n  private hostChangedRoute?: (route: string, routeState?: any) => void\n  private contextData?: string\n\n  constructor(configuration: ExtensionHostApiConfiguration) {\n    this._configuration = configuration\n    const { chattyHost, setInitialRoute, hostChangedRoute } =\n      this._configuration\n    this.chattyHost = chattyHost\n    this.setInitialRoute = setInitialRoute\n    this.hostChangedRoute = hostChangedRoute\n  }\n\n  get lookerHostData() {\n    return this._lookerHostData\n  }\n\n  handleNotification(\n    message?: ExtensionNotification\n  ): ExtensionInitializationResponse | undefined {\n    const { type, payload } = message || {}\n    switch (type) {\n      case ExtensionNotificationType.ROUTE_CHANGED:\n        if (this.hostChangedRoute && payload) {\n          const { route, routeState } = payload as RouteChangeData\n          if (route) {\n            this.hostChangedRoute(route, routeState)\n          }\n        }\n        return undefined\n      case ExtensionNotificationType.INITIALIZE: {\n        this._lookerHostData = payload as LookerHostData\n        if (this._lookerHostData) {\n          this.contextData = this._lookerHostData.contextData\n        }\n        let errorMessage\n        if (\n          this._configuration.requiredLookerVersion &&\n          this._lookerHostData &&\n          this._lookerHostData.lookerVersion\n        ) {\n          errorMessage = this.verifyLookerVersion(\n            this._configuration.requiredLookerVersion\n          )\n          if (errorMessage) {\n            console.error(errorMessage)\n          }\n        }\n        if (this.setInitialRoute && payload) {\n          const { route, routeState } = payload as LookerHostData\n          if (route) {\n            this.setInitialRoute(route, routeState)\n          }\n        }\n        return {\n          extensionSdkVersion: EXTENSION_SDK_VERSION,\n          errorMessage,\n        }\n      }\n      default:\n        console.error('Unrecognized extension notification', message)\n        throw new Error(`Unrecognized extension notification type ${type}`)\n    }\n  }\n\n  createSecretKeyTag(keyName: string): string {\n    const errorMessage = this.verifyLookerVersion('>=7.11')\n    if (errorMessage) {\n      throw new Error(errorMessage)\n    }\n    if (!keyName.match(/^[A-Za-z0-9_.]+$/)) {\n      throw new Error('Unsupported characters in key name')\n    }\n    return `{{${this._lookerHostData!.extensionId.replace(\n      /::|-/g,\n      '_'\n    )}_${keyName}}}`\n  }\n\n  async verifyHostConnection() {\n    return this.sendAndReceive(ExtensionRequestType.VERIFY_HOST)\n  }\n\n  async invokeCoreSdk(\n    httpMethod: string,\n    path: string,\n    params?: any,\n    body?: any,\n    authenticator?: any,\n    options?: any,\n    apiVersion?: ApiVersion\n  ): Promise<any> {\n    return this.sendAndReceive(ExtensionRequestType.INVOKE_CORE_SDK, {\n      httpMethod,\n      path,\n      params,\n      body,\n      authenticator,\n      options,\n      apiVersion,\n    })\n  }\n\n  async invokeCoreSdkRaw(\n    httpMethod: string,\n    path: string,\n    params?: any,\n    body?: any,\n    apiVersion?: ApiVersion\n  ): Promise<any> {\n    return this.sendAndReceive(ExtensionRequestType.RAW_INVOKE_CORE_SDK, {\n      httpMethod,\n      path,\n      params,\n      body,\n      apiVersion,\n    })\n  }\n\n  updateTitle(title: string) {\n    this.send(ExtensionRequestType.UPDATE_TITLE, { title })\n  }\n\n  updateLocation(url: string, state?: any, target?: string) {\n    this.send(ExtensionRequestType.UPDATE_LOCATION, { url, state, target })\n  }\n\n  spartanLogout() {\n    this.send(ExtensionRequestType.SPARTAN_LOGOUT)\n  }\n\n  openBrowserWindow(url: string, target?: string) {\n    this.send(ExtensionRequestType.UPDATE_LOCATION, {\n      url,\n      undefined,\n      target: target || '_blank',\n    })\n  }\n\n  closeHostPopovers() {\n    this.send(ExtensionRequestType.CLOSE_HOST_POPOVERS)\n  }\n\n  clientRouteChanged(route: string, routeState?: any) {\n    this.send(ExtensionRequestType.ROUTE_CHANGED, {\n      route,\n      routeState,\n    })\n  }\n\n  async localStorageSetItem(name: string, value = ''): Promise<boolean> {\n    if (this._lookerHostData && !this._lookerHostData.lookerVersion) {\n      return Promise.reject(\n        new Error(\n          'localStorageSetItem not supported by the current Looker host'\n        )\n      )\n    }\n    return this.sendAndReceive(ExtensionRequestType.LOCAL_STORAGE, {\n      type: 'set',\n      name,\n      value,\n    })\n  }\n\n  async localStorageGetItem(name: string): Promise<string | null> {\n    if (this._lookerHostData && !this._lookerHostData.lookerVersion) {\n      return Promise.reject(\n        new Error(\n          'localStorageGetItem not supported by the current Looker host'\n        )\n      )\n    }\n    return this.sendAndReceive(ExtensionRequestType.LOCAL_STORAGE, {\n      type: 'get',\n      name,\n    })\n  }\n\n  async localStorageRemoveItem(name: string): Promise<boolean> {\n    if (this._lookerHostData && !this._lookerHostData.lookerVersion) {\n      return Promise.reject(\n        new Error(\n          'localStorageRemoveItem not supported by the current Looker host'\n        )\n      )\n    }\n    return this.sendAndReceive(ExtensionRequestType.LOCAL_STORAGE, {\n      type: 'remove',\n      name,\n    })\n  }\n\n  async clipboardWrite(value: string): Promise<void> {\n    const errorMessage = this.verifyLookerVersion('>=21.7')\n    if (errorMessage) {\n      return Promise.reject(new Error(errorMessage))\n    }\n    return this.sendAndReceive(ExtensionRequestType.CLIPBOARD, {\n      type: 'write',\n      value,\n    })\n  }\n\n  async userAttributeSetItem(name: string, value = ''): Promise<boolean> {\n    // User attributes added in Looker version 7.13, updated in 7.15\n    const errorMessage = this.verifyLookerVersion('>=7.15')\n    if (errorMessage) {\n      return Promise.reject(new Error(errorMessage))\n    }\n    return this.sendAndReceive(ExtensionRequestType.USER_ATTRIBUTE, {\n      type: 'set',\n      name,\n      value,\n    })\n  }\n\n  async userAttributeGetItem(name: string): Promise<string | null> {\n    // User attributes added in Looker version 7.13, updated in 7.15\n    const errorMessage = this.verifyLookerVersion('>=7.15')\n    if (errorMessage) {\n      return Promise.reject(new Error(errorMessage))\n    }\n    return this.sendAndReceive(ExtensionRequestType.USER_ATTRIBUTE, {\n      type: 'get',\n      name,\n    })\n  }\n\n  async userAttributeResetItem(name: string): Promise<void> {\n    // User attributes added in Looker version 7.13, updated in 7.15\n    const errorMessage = this.verifyLookerVersion('>=7.15')\n    if (errorMessage) {\n      return Promise.reject(new Error(errorMessage))\n    }\n    return this.sendAndReceive(ExtensionRequestType.USER_ATTRIBUTE, {\n      type: 'reset',\n      name,\n    })\n  }\n\n  getContextData() {\n    const errorMessage = this.verifyLookerVersion('>=7.13')\n    if (errorMessage) {\n      throw new Error(errorMessage)\n    }\n    if (this.contextData) {\n      return JSON.parse(this.contextData)\n    } else {\n      return undefined\n    }\n  }\n\n  async saveContextData(context: any): Promise<any> {\n    const errorMessage = this.verifyLookerVersion('>=7.13')\n    if (errorMessage) {\n      return Promise.reject(new Error(errorMessage))\n    }\n    let contextData: string | undefined\n    if (context) {\n      try {\n        contextData = JSON.stringify(context)\n      } catch (err) {\n        return Promise.reject(new Error('context cannot be serialized'))\n      }\n    } else {\n      contextData = undefined\n    }\n    await this.sendAndReceive(ExtensionRequestType.CONTEXT_DATA, {\n      type: 'save',\n      contextData,\n    })\n    return this.getContextData()\n  }\n\n  async refreshContextData(): Promise<any> {\n    const errorMessage = this.verifyLookerVersion('>=7.13')\n    if (errorMessage) {\n      return Promise.reject(new Error(errorMessage))\n    }\n    this.contextData = await this.sendAndReceive(\n      ExtensionRequestType.CONTEXT_DATA,\n      {\n        type: 'refresh',\n      }\n    )\n    return this.getContextData()\n  }\n\n  track(name: string, trackAction: string, attributes?: Record<string, any>) {\n    this.send(ExtensionRequestType.TRACK_ACTION, {\n      name,\n      trackAction,\n      attributes,\n    })\n  }\n\n  error(errorEvent: ErrorEvent) {\n    if (this._lookerHostData) {\n      const { message, filename, lineno, colno, error } = errorEvent || {}\n      this.send(ExtensionRequestType.ERROR_EVENT, {\n        message,\n        filename,\n        lineno,\n        colno,\n        error: error && error.toString ? error.toString() : error,\n      })\n    } else {\n      console.error(\n        'Unhandled error but Looker host connection not established',\n        errorEvent\n      )\n    }\n  }\n\n  unloaded() {\n    this.send(ExtensionRequestType.EXTENSION_UNLOADED, {})\n  }\n\n  createFetchProxy(\n    baseUrl?: string,\n    init?: FetchCustomParameters,\n    responseBodyType?: FetchResponseBodyType\n  ) {\n    return new FetchProxyImpl(this, baseUrl, init, responseBodyType)\n  }\n\n  async fetchProxy(\n    resource: string,\n    init?: FetchCustomParameters,\n    responseBodyType?: FetchResponseBodyType\n  ) {\n    // Fetch proxy support added to Looker 7.9\n    const errorMessage = this.verifyLookerVersion('>=7.9')\n    if (errorMessage) {\n      return Promise.reject(new Error(errorMessage))\n    }\n    return this.sendAndReceive(ExtensionRequestType.INVOKE_EXTERNAL_API, {\n      type: 'fetch',\n      payload: {\n        resource,\n        init,\n        responseBodyType,\n      },\n    })\n  }\n\n  async serverProxy(\n    resource: string,\n    init?: FetchCustomParameters,\n    responseBodyType?: FetchResponseBodyType\n  ) {\n    // Server proxy support added to Looker 7.11\n    const errorMessage = this.verifyLookerVersion('>=7.11')\n    if (errorMessage) {\n      return Promise.reject(new Error(errorMessage))\n    }\n    return this.sendAndReceive(ExtensionRequestType.INVOKE_EXTERNAL_API, {\n      type: 'server-proxy',\n      payload: {\n        resource,\n        init,\n        responseBodyType,\n      },\n    })\n  }\n\n  async oauth2Authenticate(\n    authEndpoint: string,\n    authParameters: Record<string, string>,\n    httpMethod = 'POST'\n  ) {\n    // oauth2Authenticate proxy support added to Looker 7.9\n    let errorMessage = this.verifyLookerVersion('>=7.9')\n    if (errorMessage) {\n      return Promise.reject(new Error(errorMessage))\n    }\n    errorMessage = this.validateAuthParameters(authParameters)\n    if (errorMessage) {\n      return Promise.reject(new Error(errorMessage))\n    }\n    return this.sendAndReceive(\n      ExtensionRequestType.INVOKE_EXTERNAL_API,\n      {\n        type: 'oauth2_authenticate',\n        payload: {\n          authEndpoint,\n          authParameters,\n          httpMethod,\n        },\n      },\n      // Adding the signal disables the default timeout\n      { signal: new AbortController().signal }\n    )\n  }\n\n  async oauth2ExchangeCodeForToken(\n    authEndpoint: string,\n    authParameters: Record<string, string>\n  ) {\n    const errorMessage = this.verifyLookerVersion('>=7.11')\n    if (errorMessage) {\n      return Promise.reject(new Error(errorMessage))\n    }\n    return this.sendAndReceive(ExtensionRequestType.INVOKE_EXTERNAL_API, {\n      type: 'oauth2_exchange_code',\n      payload: {\n        authEndpoint,\n        authParameters,\n      },\n    })\n  }\n\n  private async sendAndReceive(\n    type: string,\n    payload?: any,\n    options?: Options\n  ): Promise<any> {\n    if (!this._lookerHostData) {\n      return Promise.reject(new Error('Looker host connection not established'))\n    }\n    const messagePayload = {\n      type,\n      payload,\n    }\n    const chattyPayload = options ? [messagePayload, options] : [messagePayload]\n    return this.chattyHost\n      .sendAndReceive(ExtensionEvent.EXTENSION_API_REQUEST, ...chattyPayload)\n      .then((values) => values[0])\n  }\n\n  private send(type: string, payload?: any) {\n    if (!this._lookerHostData) {\n      throw new Error('Looker host connection not established')\n    }\n    this.chattyHost.send(ExtensionEvent.EXTENSION_API_REQUEST, {\n      type,\n      payload,\n    })\n  }\n\n  private verifyLookerVersion(version: string): string | undefined {\n    // Default version to 7.0 as that's the first Looker version that officially\n    // supported extensions. Version 6.24 has some support for extensions but most\n    // likely will fail before reaching this point\n    const lookerVersion = this._lookerHostData\n      ? this._lookerHostData.lookerVersion || '7.0'\n      : '7.0'\n    if (!this._lookerHostData || !intersects(version, lookerVersion, true)) {\n      return `Extension requires Looker version ${version}, got ${lookerVersion}`\n    }\n    return undefined\n  }\n\n  private validateAuthParameters(authParameters: Record<string, string>) {\n    if (!authParameters.client_id) {\n      return 'client_id missing'\n    }\n    if (authParameters.redirect_uri) {\n      return 'redirect_uri must NOT be included'\n    }\n    if (\n      authParameters.response_type !== 'token' &&\n      authParameters.response_type !== 'id_token' &&\n      authParameters.response_type !== 'code'\n    ) {\n      return `invalid response_type, must be token, id_token or code, ${authParameters.response_type}`\n    }\n    return undefined\n  }\n}\n"],"mappings":";;;;;;AA2BA;AACA;AAYA;AAIgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAET,IAAMA,qBAAqB,GAAG,QAAQ;AAAA;AAEtC,MAAMC,oBAAoB,CAA6B;EAQ5DC,WAAW,CAACC,aAA4C,EAAE;IAAA;IAAA;IAAA;IAAA;IAAA;IAAA;IACxD,IAAI,CAACC,cAAc,GAAGD,aAAa;IACnC,IAAM;MAAEE,UAAU;MAAEC,eAAe;MAAEC;IAAiB,CAAC,GACrD,IAAI,CAACH,cAAc;IACrB,IAAI,CAACC,UAAU,GAAGA,UAAU;IAC5B,IAAI,CAACC,eAAe,GAAGA,eAAe;IACtC,IAAI,CAACC,gBAAgB,GAAGA,gBAAgB;EAC1C;EAEA,IAAIC,cAAc,GAAG;IACnB,OAAO,IAAI,CAACC,eAAe;EAC7B;EAEAC,kBAAkB,CAChBC,OAA+B,EACc;IAC7C,IAAM;MAAEC,IAAI;MAAEC;IAAQ,CAAC,GAAGF,OAAO,IAAI,CAAC,CAAC;IACvC,QAAQC,IAAI;MACV,KAAKE,gCAAyB,CAACC,aAAa;QAC1C,IAAI,IAAI,CAACR,gBAAgB,IAAIM,OAAO,EAAE;UACpC,IAAM;YAAEG,KAAK,EAALA,MAAK;YAAEC,UAAU,EAAVA;UAAW,CAAC,GAAGJ,OAA0B;UACxD,IAAIG,MAAK,EAAE;YACT,IAAI,CAACT,gBAAgB,CAACS,MAAK,EAAEC,WAAU,CAAC;UAC1C;QACF;QACA,OAAOC,SAAS;MAClB,KAAKJ,gCAAyB,CAACK,UAAU;QAAE;UACzC,IAAI,CAACV,eAAe,GAAGI,OAAyB;UAChD,IAAI,IAAI,CAACJ,eAAe,EAAE;YACxB,IAAI,CAACW,WAAW,GAAG,IAAI,CAACX,eAAe,CAACW,WAAW;UACrD;UACA,IAAIC,YAAY;UAChB,IACE,IAAI,CAACjB,cAAc,CAACkB,qBAAqB,IACzC,IAAI,CAACb,eAAe,IACpB,IAAI,CAACA,eAAe,CAACc,aAAa,EAClC;YACAF,YAAY,GAAG,IAAI,CAACG,mBAAmB,CACrC,IAAI,CAACpB,cAAc,CAACkB,qBAAqB,CAC1C;YACD,IAAID,YAAY,EAAE;cAChBI,OAAO,CAACC,KAAK,CAACL,YAAY,CAAC;YAC7B;UACF;UACA,IAAI,IAAI,CAACf,eAAe,IAAIO,OAAO,EAAE;YACnC,IAAM;cAAEG,KAAK,EAALA,OAAK;cAAEC,UAAU,EAAVA;YAAW,CAAC,GAAGJ,OAAyB;YACvD,IAAIG,OAAK,EAAE;cACT,IAAI,CAACV,eAAe,CAACU,OAAK,EAAEC,YAAU,CAAC;YACzC;UACF;UACA,OAAO;YACLU,mBAAmB,EAAE3B,qBAAqB;YAC1CqB;UACF,CAAC;QACH;MACA;QACEI,OAAO,CAACC,KAAK,CAAC,qCAAqC,EAAEf,OAAO,CAAC;QAC7D,MAAM,IAAIiB,KAAK,oDAA6ChB,IAAI,EAAG;IAAA;EAEzE;EAEAiB,kBAAkB,CAACC,OAAe,EAAU;IAC1C,IAAMT,YAAY,GAAG,IAAI,CAACG,mBAAmB,CAAC,QAAQ,CAAC;IACvD,IAAIH,YAAY,EAAE;MAChB,MAAM,IAAIO,KAAK,CAACP,YAAY,CAAC;IAC/B;IACA,IAAI,CAACS,OAAO,CAACC,KAAK,CAAC,kBAAkB,CAAC,EAAE;MACtC,MAAM,IAAIH,KAAK,CAAC,oCAAoC,CAAC;IACvD;IACA,mBAAY,IAAI,CAACnB,eAAe,CAAEuB,WAAW,CAACC,OAAO,CACnD,OAAO,EACP,GAAG,CACJ,cAAIH,OAAO;EACd;EAEMI,oBAAoB,GAAG;IAAA;IAAA;MAC3B,OAAO,KAAI,CAACC,cAAc,CAACC,2BAAoB,CAACC,WAAW,CAAC;IAAA;EAC9D;EAEMC,aAAa,CACjBC,UAAkB,EAClBC,IAAY,EACZC,MAAY,EACZC,IAAU,EACVC,aAAmB,EACnBC,OAAa,EACbC,UAAuB,EACT;IAAA;IAAA;MACd,OAAO,MAAI,CAACV,cAAc,CAACC,2BAAoB,CAACU,eAAe,EAAE;QAC/DP,UAAU;QACVC,IAAI;QACJC,MAAM;QACNC,IAAI;QACJC,aAAa;QACbC,OAAO;QACPC;MACF,CAAC,CAAC;IAAA;EACJ;EAEME,gBAAgB,CACpBR,UAAkB,EAClBC,IAAY,EACZC,MAAY,EACZC,IAAU,EACVG,UAAuB,EACT;IAAA;IAAA;MACd,OAAO,MAAI,CAACV,cAAc,CAACC,2BAAoB,CAACY,mBAAmB,EAAE;QACnET,UAAU;QACVC,IAAI;QACJC,MAAM;QACNC,IAAI;QACJG;MACF,CAAC,CAAC;IAAA;EACJ;EAEAI,WAAW,CAACC,KAAa,EAAE;IACzB,IAAI,CAACC,IAAI,CAACf,2BAAoB,CAACgB,YAAY,EAAE;MAAEF;IAAM,CAAC,CAAC;EACzD;EAEAG,cAAc,CAACC,GAAW,EAAEC,KAAW,EAAEC,MAAe,EAAE;IACxD,IAAI,CAACL,IAAI,CAACf,2BAAoB,CAACqB,eAAe,EAAE;MAAEH,GAAG;MAAEC,KAAK;MAAEC;IAAO,CAAC,CAAC;EACzE;EAEAE,aAAa,GAAG;IACd,IAAI,CAACP,IAAI,CAACf,2BAAoB,CAACuB,cAAc,CAAC;EAChD;EAEAC,iBAAiB,CAACN,GAAW,EAAEE,MAAe,EAAE;IAC9C,IAAI,CAACL,IAAI,CAACf,2BAAoB,CAACqB,eAAe,EAAE;MAC9CH,GAAG;MACHpC,SAAS;MACTsC,MAAM,EAAEA,MAAM,IAAI;IACpB,CAAC,CAAC;EACJ;EAEAK,iBAAiB,GAAG;IAClB,IAAI,CAACV,IAAI,CAACf,2BAAoB,CAAC0B,mBAAmB,CAAC;EACrD;EAEAC,kBAAkB,CAAC/C,KAAa,EAAEC,UAAgB,EAAE;IAClD,IAAI,CAACkC,IAAI,CAACf,2BAAoB,CAACrB,aAAa,EAAE;MAC5CC,KAAK;MACLC;IACF,CAAC,CAAC;EACJ;EAEM+C,mBAAmB,CAACC,IAAY,EAAgC;IAAA;MAAA;IAAA;MAAA,IAA9BC,KAAK,0EAAG,EAAE;MAChD,IAAI,MAAI,CAACzD,eAAe,IAAI,CAAC,MAAI,CAACA,eAAe,CAACc,aAAa,EAAE;QAC/D,OAAO4C,OAAO,CAACC,MAAM,CACnB,IAAIxC,KAAK,CACP,8DAA8D,CAC/D,CACF;MACH;MACA,OAAO,MAAI,CAACO,cAAc,CAACC,2BAAoB,CAACiC,aAAa,EAAE;QAC7DzD,IAAI,EAAE,KAAK;QACXqD,IAAI;QACJC;MACF,CAAC,CAAC;IAAA;EACJ;EAEMI,mBAAmB,CAACL,IAAY,EAA0B;IAAA;IAAA;MAC9D,IAAI,MAAI,CAACxD,eAAe,IAAI,CAAC,MAAI,CAACA,eAAe,CAACc,aAAa,EAAE;QAC/D,OAAO4C,OAAO,CAACC,MAAM,CACnB,IAAIxC,KAAK,CACP,8DAA8D,CAC/D,CACF;MACH;MACA,OAAO,MAAI,CAACO,cAAc,CAACC,2BAAoB,CAACiC,aAAa,EAAE;QAC7DzD,IAAI,EAAE,KAAK;QACXqD;MACF,CAAC,CAAC;IAAA;EACJ;EAEMM,sBAAsB,CAACN,IAAY,EAAoB;IAAA;IAAA;MAC3D,IAAI,MAAI,CAACxD,eAAe,IAAI,CAAC,MAAI,CAACA,eAAe,CAACc,aAAa,EAAE;QAC/D,OAAO4C,OAAO,CAACC,MAAM,CACnB,IAAIxC,KAAK,CACP,iEAAiE,CAClE,CACF;MACH;MACA,OAAO,MAAI,CAACO,cAAc,CAACC,2BAAoB,CAACiC,aAAa,EAAE;QAC7DzD,IAAI,EAAE,QAAQ;QACdqD;MACF,CAAC,CAAC;IAAA;EACJ;EAEMO,cAAc,CAACN,KAAa,EAAiB;IAAA;IAAA;MACjD,IAAM7C,YAAY,GAAG,MAAI,CAACG,mBAAmB,CAAC,QAAQ,CAAC;MACvD,IAAIH,YAAY,EAAE;QAChB,OAAO8C,OAAO,CAACC,MAAM,CAAC,IAAIxC,KAAK,CAACP,YAAY,CAAC,CAAC;MAChD;MACA,OAAO,MAAI,CAACc,cAAc,CAACC,2BAAoB,CAACqC,SAAS,EAAE;QACzD7D,IAAI,EAAE,OAAO;QACbsD;MACF,CAAC,CAAC;IAAA;EACJ;EAEMQ,oBAAoB,CAACT,IAAY,EAAgC;IAAA;MAAA;IAAA;MAAA,IAA9BC,KAAK,6EAAG,EAAE;MAEjD,IAAM7C,YAAY,GAAG,MAAI,CAACG,mBAAmB,CAAC,QAAQ,CAAC;MACvD,IAAIH,YAAY,EAAE;QAChB,OAAO8C,OAAO,CAACC,MAAM,CAAC,IAAIxC,KAAK,CAACP,YAAY,CAAC,CAAC;MAChD;MACA,OAAO,MAAI,CAACc,cAAc,CAACC,2BAAoB,CAACuC,cAAc,EAAE;QAC9D/D,IAAI,EAAE,KAAK;QACXqD,IAAI;QACJC;MACF,CAAC,CAAC;IAAA;EACJ;EAEMU,oBAAoB,CAACX,IAAY,EAA0B;IAAA;IAAA;MAE/D,IAAM5C,YAAY,GAAG,MAAI,CAACG,mBAAmB,CAAC,QAAQ,CAAC;MACvD,IAAIH,YAAY,EAAE;QAChB,OAAO8C,OAAO,CAACC,MAAM,CAAC,IAAIxC,KAAK,CAACP,YAAY,CAAC,CAAC;MAChD;MACA,OAAO,MAAI,CAACc,cAAc,CAACC,2BAAoB,CAACuC,cAAc,EAAE;QAC9D/D,IAAI,EAAE,KAAK;QACXqD;MACF,CAAC,CAAC;IAAA;EACJ;EAEMY,sBAAsB,CAACZ,IAAY,EAAiB;IAAA;IAAA;MAExD,IAAM5C,YAAY,GAAG,OAAI,CAACG,mBAAmB,CAAC,QAAQ,CAAC;MACvD,IAAIH,YAAY,EAAE;QAChB,OAAO8C,OAAO,CAACC,MAAM,CAAC,IAAIxC,KAAK,CAACP,YAAY,CAAC,CAAC;MAChD;MACA,OAAO,OAAI,CAACc,cAAc,CAACC,2BAAoB,CAACuC,cAAc,EAAE;QAC9D/D,IAAI,EAAE,OAAO;QACbqD;MACF,CAAC,CAAC;IAAA;EACJ;EAEAa,cAAc,GAAG;IACf,IAAMzD,YAAY,GAAG,IAAI,CAACG,mBAAmB,CAAC,QAAQ,CAAC;IACvD,IAAIH,YAAY,EAAE;MAChB,MAAM,IAAIO,KAAK,CAACP,YAAY,CAAC;IAC/B;IACA,IAAI,IAAI,CAACD,WAAW,EAAE;MACpB,OAAO2D,IAAI,CAACC,KAAK,CAAC,IAAI,CAAC5D,WAAW,CAAC;IACrC,CAAC,MAAM;MACL,OAAOF,SAAS;IAClB;EACF;EAEM+D,eAAe,CAACC,OAAY,EAAgB;IAAA;IAAA;MAChD,IAAM7D,YAAY,GAAG,OAAI,CAACG,mBAAmB,CAAC,QAAQ,CAAC;MACvD,IAAIH,YAAY,EAAE;QAChB,OAAO8C,OAAO,CAACC,MAAM,CAAC,IAAIxC,KAAK,CAACP,YAAY,CAAC,CAAC;MAChD;MACA,IAAID,WAA+B;MACnC,IAAI8D,OAAO,EAAE;QACX,IAAI;UACF9D,WAAW,GAAG2D,IAAI,CAACI,SAAS,CAACD,OAAO,CAAC;QACvC,CAAC,CAAC,OAAOE,GAAG,EAAE;UACZ,OAAOjB,OAAO,CAACC,MAAM,CAAC,IAAIxC,KAAK,CAAC,8BAA8B,CAAC,CAAC;QAClE;MACF,CAAC,MAAM;QACLR,WAAW,GAAGF,SAAS;MACzB;MACA,MAAM,OAAI,CAACiB,cAAc,CAACC,2BAAoB,CAACiD,YAAY,EAAE;QAC3DzE,IAAI,EAAE,MAAM;QACZQ;MACF,CAAC,CAAC;MACF,OAAO,OAAI,CAAC0D,cAAc,EAAE;IAAA;EAC9B;EAEMQ,kBAAkB,GAAiB;IAAA;IAAA;MACvC,IAAMjE,YAAY,GAAG,OAAI,CAACG,mBAAmB,CAAC,QAAQ,CAAC;MACvD,IAAIH,YAAY,EAAE;QAChB,OAAO8C,OAAO,CAACC,MAAM,CAAC,IAAIxC,KAAK,CAACP,YAAY,CAAC,CAAC;MAChD;MACA,OAAI,CAACD,WAAW,SAAS,OAAI,CAACe,cAAc,CAC1CC,2BAAoB,CAACiD,YAAY,EACjC;QACEzE,IAAI,EAAE;MACR,CAAC,CACF;MACD,OAAO,OAAI,CAACkE,cAAc,EAAE;IAAA;EAC9B;EAEAS,KAAK,CAACtB,IAAY,EAAEuB,WAAmB,EAAEC,UAAgC,EAAE;IACzE,IAAI,CAACtC,IAAI,CAACf,2BAAoB,CAACsD,YAAY,EAAE;MAC3CzB,IAAI;MACJuB,WAAW;MACXC;IACF,CAAC,CAAC;EACJ;EAEA/D,KAAK,CAACiE,UAAsB,EAAE;IAC5B,IAAI,IAAI,CAAClF,eAAe,EAAE;MACxB,IAAM;QAAEE,OAAO;QAAEiF,QAAQ;QAAEC,MAAM;QAAEC,KAAK;QAAEpE;MAAM,CAAC,GAAGiE,UAAU,IAAI,CAAC,CAAC;MACpE,IAAI,CAACxC,IAAI,CAACf,2BAAoB,CAAC2D,WAAW,EAAE;QAC1CpF,OAAO;QACPiF,QAAQ;QACRC,MAAM;QACNC,KAAK;QACLpE,KAAK,EAAEA,KAAK,IAAIA,KAAK,CAACsE,QAAQ,GAAGtE,KAAK,CAACsE,QAAQ,EAAE,GAAGtE;MACtD,CAAC,CAAC;IACJ,CAAC,MAAM;MACLD,OAAO,CAACC,KAAK,CACX,4DAA4D,EAC5DiE,UAAU,CACX;IACH;EACF;EAEAM,QAAQ,GAAG;IACT,IAAI,CAAC9C,IAAI,CAACf,2BAAoB,CAAC8D,kBAAkB,EAAE,CAAC,CAAC,CAAC;EACxD;EAEAC,gBAAgB,CACdC,OAAgB,EAChBC,IAA4B,EAC5BC,gBAAwC,EACxC;IACA,OAAO,IAAIC,2BAAc,CAAC,IAAI,EAAEH,OAAO,EAAEC,IAAI,EAAEC,gBAAgB,CAAC;EAClE;EAEME,UAAU,CACdC,QAAgB,EAChBJ,IAA4B,EAC5BC,gBAAwC,EACxC;IAAA;IAAA;MAEA,IAAMjF,YAAY,GAAG,OAAI,CAACG,mBAAmB,CAAC,OAAO,CAAC;MACtD,IAAIH,YAAY,EAAE;QAChB,OAAO8C,OAAO,CAACC,MAAM,CAAC,IAAIxC,KAAK,CAACP,YAAY,CAAC,CAAC;MAChD;MACA,OAAO,OAAI,CAACc,cAAc,CAACC,2BAAoB,CAACsE,mBAAmB,EAAE;QACnE9F,IAAI,EAAE,OAAO;QACbC,OAAO,EAAE;UACP4F,QAAQ;UACRJ,IAAI;UACJC;QACF;MACF,CAAC,CAAC;IAAA;EACJ;EAEMK,WAAW,CACfF,QAAgB,EAChBJ,IAA4B,EAC5BC,gBAAwC,EACxC;IAAA;IAAA;MAEA,IAAMjF,YAAY,GAAG,OAAI,CAACG,mBAAmB,CAAC,QAAQ,CAAC;MACvD,IAAIH,YAAY,EAAE;QAChB,OAAO8C,OAAO,CAACC,MAAM,CAAC,IAAIxC,KAAK,CAACP,YAAY,CAAC,CAAC;MAChD;MACA,OAAO,OAAI,CAACc,cAAc,CAACC,2BAAoB,CAACsE,mBAAmB,EAAE;QACnE9F,IAAI,EAAE,cAAc;QACpBC,OAAO,EAAE;UACP4F,QAAQ;UACRJ,IAAI;UACJC;QACF;MACF,CAAC,CAAC;IAAA;EACJ;EAEMM,kBAAkB,CACtBC,YAAoB,EACpBC,cAAsC,EAEtC;IAAA;MAAA;IAAA;MAAA,IADAvE,UAAU,6EAAG,MAAM;MAGnB,IAAIlB,YAAY,GAAG,OAAI,CAACG,mBAAmB,CAAC,OAAO,CAAC;MACpD,IAAIH,YAAY,EAAE;QAChB,OAAO8C,OAAO,CAACC,MAAM,CAAC,IAAIxC,KAAK,CAACP,YAAY,CAAC,CAAC;MAChD;MACAA,YAAY,GAAG,OAAI,CAAC0F,sBAAsB,CAACD,cAAc,CAAC;MAC1D,IAAIzF,YAAY,EAAE;QAChB,OAAO8C,OAAO,CAACC,MAAM,CAAC,IAAIxC,KAAK,CAACP,YAAY,CAAC,CAAC;MAChD;MACA,OAAO,OAAI,CAACc,cAAc,CACxBC,2BAAoB,CAACsE,mBAAmB,EACxC;QACE9F,IAAI,EAAE,qBAAqB;QAC3BC,OAAO,EAAE;UACPgG,YAAY;UACZC,cAAc;UACdvE;QACF;MACF,CAAC,EAED;QAAEyE,MAAM,EAAE,IAAIC,eAAe,EAAE,CAACD;MAAO,CAAC,CACzC;IAAA;EACH;EAEME,0BAA0B,CAC9BL,YAAoB,EACpBC,cAAsC,EACtC;IAAA;IAAA;MACA,IAAMzF,YAAY,GAAG,OAAI,CAACG,mBAAmB,CAAC,QAAQ,CAAC;MACvD,IAAIH,YAAY,EAAE;QAChB,OAAO8C,OAAO,CAACC,MAAM,CAAC,IAAIxC,KAAK,CAACP,YAAY,CAAC,CAAC;MAChD;MACA,OAAO,OAAI,CAACc,cAAc,CAACC,2BAAoB,CAACsE,mBAAmB,EAAE;QACnE9F,IAAI,EAAE,sBAAsB;QAC5BC,OAAO,EAAE;UACPgG,YAAY;UACZC;QACF;MACF,CAAC,CAAC;IAAA;EACJ;EAEc3E,cAAc,CAC1BvB,IAAY,EACZC,OAAa,EACb+B,OAAiB,EACH;IAAA;IAAA;MACd,IAAI,CAAC,OAAI,CAACnC,eAAe,EAAE;QACzB,OAAO0D,OAAO,CAACC,MAAM,CAAC,IAAIxC,KAAK,CAAC,wCAAwC,CAAC,CAAC;MAC5E;MACA,IAAMuF,cAAc,GAAG;QACrBvG,IAAI;QACJC;MACF,CAAC;MACD,IAAMuG,aAAa,GAAGxE,OAAO,GAAG,CAACuE,cAAc,EAAEvE,OAAO,CAAC,GAAG,CAACuE,cAAc,CAAC;MAC5E,OAAO,OAAI,CAAC9G,UAAU,CACnB8B,cAAc,CAACkF,qBAAc,CAACC,qBAAqB,EAAE,GAAGF,aAAa,CAAC,CACtEG,IAAI,CAAEC,MAAM,IAAKA,MAAM,CAAC,CAAC,CAAC,CAAC;IAAA;EAChC;EAEQrE,IAAI,CAACvC,IAAY,EAAEC,OAAa,EAAE;IACxC,IAAI,CAAC,IAAI,CAACJ,eAAe,EAAE;MACzB,MAAM,IAAImB,KAAK,CAAC,wCAAwC,CAAC;IAC3D;IACA,IAAI,CAACvB,UAAU,CAAC8C,IAAI,CAACkE,qBAAc,CAACC,qBAAqB,EAAE;MACzD1G,IAAI;MACJC;IACF,CAAC,CAAC;EACJ;EAEQW,mBAAmB,CAACiG,OAAe,EAAsB;IAI/D,IAAMlG,aAAa,GAAG,IAAI,CAACd,eAAe,GACtC,IAAI,CAACA,eAAe,CAACc,aAAa,IAAI,KAAK,GAC3C,KAAK;IACT,IAAI,CAAC,IAAI,CAACd,eAAe,IAAI,CAAC,IAAAiH,mBAAU,EAACD,OAAO,EAAElG,aAAa,EAAE,IAAI,CAAC,EAAE;MACtE,mDAA4CkG,OAAO,mBAASlG,aAAa;IAC3E;IACA,OAAOL,SAAS;EAClB;EAEQ6F,sBAAsB,CAACD,cAAsC,EAAE;IACrE,IAAI,CAACA,cAAc,CAACa,SAAS,EAAE;MAC7B,OAAO,mBAAmB;IAC5B;IACA,IAAIb,cAAc,CAACc,YAAY,EAAE;MAC/B,OAAO,mCAAmC;IAC5C;IACA,IACEd,cAAc,CAACe,aAAa,KAAK,OAAO,IACxCf,cAAc,CAACe,aAAa,KAAK,UAAU,IAC3Cf,cAAc,CAACe,aAAa,KAAK,MAAM,EACvC;MACA,yEAAkEf,cAAc,CAACe,aAAa;IAChG;IACA,OAAO3G,SAAS;EAClB;AACF;AAAC"}